import tkinter as tk
from tkinter import filedialog, messagebox

class Notepad:
    def __init__(self, root):
        self.root = root
        self.root.title("Блокнот")
        self.root.geometry("600x400")

        self.filename = None
        self.text_changed = False

        self.text = tk.Text(root, undo=True)
        self.text.pack(expand=True, fill="both")
        self.text.bind("<<Modified>>", self.on_change)

        self.menu = tk.Menu(root)
        root.config(menu=self.menu)

        file_menu = tk.Menu(self.menu, tearoff=0)
        self.menu.add_cascade(label="Файл", menu=file_menu)
        file_menu.add_command(label="Відкрити", command=self.open_file)
        file_menu.add_command(label="Зберегти", command=self.save_file)
        file_menu.add_separator()
        file_menu.add_command(label="Вийти", command=self.exit_app)

        root.protocol("WM_DELETE_WINDOW", self.exit_app)

    def on_change(self, event=None):
        self.text_changed = True
        self.text.edit_modified(False)

    def open_file(self):
        if self.text_changed and not self.ask_save_changes():
            return

        file = filedialog.askopenfilename(
            defaultextension=".txt",
            filetypes=[("Текстові файли", "*.txt"), ("Всі файли", "*.*")]
        )
        if file:
            self.filename = file
            with open(file, "r", encoding="utf-8") as f:
                content = f.read()
            self.text.delete(1.0, tk.END)
            self.text.insert(tk.END, content)
            self.text_changed = False
            self.root.title(f"Блокнот - {self.filename}")

    def save_file(self):
        if not self.filename:
            file = filedialog.asksaveasfilename(
                defaultextension=".txt",
                filetypes=[("Текстові файли", "*.txt"), ("Всі файли", "*.*")]
            )
            if not file:
                return
            self.filename = file

        with open(self.filename, "w", encoding="utf-8") as f:
            f.write(self.text.get(1.0, tk.END))
        self.text_changed = False
        self.root.title(f"Блокнот - {self.filename}")

    def ask_save_changes(self):
        response = messagebox.askyesnocancel(
            "Попередження",
            "У вас є незбережені зміни. Зберегти перед виходом?"
        )
        if response:  # Так
            self.save_file()
            return True
        elif response is None:  # Скасувати
            return False
        return True  # Ні

    def exit_app(self):
        if self.text_changed:
            if not self.ask_save_changes():
                return
        self.root.destroy()


root = tk.Tk()
app = Notepad(root)
root.mainloop()
